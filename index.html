<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Möteskostnadskalkylator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 1.5rem;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 900px;
      width: 100%;
      background: #020617;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.7);
      border: 1px solid #1f2937;
    }
    h1 {
      margin-top: 0;
      margin-bottom: 0.25rem;
      font-size: 1.6rem;
    }
    p.subtitle {
      margin-top: 0;
      margin-bottom: 1rem;
      color: #9ca3af;
      font-size: 0.95rem;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    @media (min-width: 720px) {
      .grid {
        grid-template-columns: 1.1fr 1fr;
      }
    }
    .card {
      background: #020617;
      border-radius: 0.75rem;
      border: 1px solid #1f2937;
      padding: 1rem;
    }
    .card h2 {
      margin-top: 0;
      margin-bottom: 0.5rem;
      font-size: 1.05rem;
    }
    label {
      display: block;
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 0.25rem;
    }
    input, select, textarea {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      padding: 0.4rem 0.6rem;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    textarea {
      border-radius: 0.5rem;
      min-height: 50px;
      resize: vertical;
    }
    .field {
      margin-bottom: 0.6rem;
    }
    .inline {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .inline span.unit {
      font-size: 0.8rem;
      color: #6b7280;
      white-space: nowrap;
    }
    .hint {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.15rem;
    }
    .actions {
      margin-top: 0.75rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 0.5rem 0.9rem;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }
    .primary {
      background: #2563eb;
      color: white;
    }
    .secondary {
      background: transparent;
      color: #e5e7eb;
      border: 1px solid #374151;
    }
    .error {
      color: #ef4444;
      font-size: 0.8rem;
      margin-top: 0.25rem;
      min-height: 1em;
    }
    .meeting-title {
      font-size: 0.9rem;
      color: #9ca3af;
      margin-top: 0;
      margin-bottom: 0.5rem;
    }
    .meeting-title strong {
      color: #e5e7eb;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      border: 1px solid #2563eb;
      background: rgba(37, 99, 235, 0.2);
      font-size: 0.75rem;
      color: #bfdbfe;
      margin-bottom: 0.5rem;
    }
    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }
    .metrics {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.6rem;
      margin-bottom: 0.75rem;
    }
    @media (min-width: 520px) {
      .metrics {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }
    .metric {
      border-radius: 0.6rem;
      border: 1px solid #1f2937;
      padding: 0.45rem 0.6rem;
      font-size: 0.8rem;
    }
    .metric-label {
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #9ca3af;
      font-size: 0.7rem;
      margin-bottom: 0.15rem;
    }
    .metric-value {
      font-weight: 600;
      font-variant-numeric: tabular-nums;
      font-size: 0.95rem;
    }
    .metric-sub {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.1rem;
    }
    .footer {
      border-top: 1px solid #1f2937;
      padding-top: 0.6rem;
      margin-top: 0.3rem;
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      align-items: center;
      font-size: 0.75rem;
      color: #9ca3af;
      flex-wrap: wrap;
    }
    .copy-status {
      font-size: 0.75rem;
      color: #22c55e;
      min-height: 1em;
    }
    /* Sparade beräkningar */
    .saved-empty {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .saved-list {
      list-style: none;
      margin: 0.5rem 0 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-height: 260px;
      overflow-y: auto;
    }
    .saved-item {
      display: flex;
      gap: 0.5rem;
      align-items: flex-start;
      justify-content: space-between;
      border-radius: 0.6rem;
      border: 1px solid #1f2937;
      padding: 0.5rem 0.6rem;
      font-size: 0.8rem;
      background: #020617;
    }
    .saved-main {
      flex: 1 1 auto;
    }
    .saved-title {
      font-weight: 600;
      margin-bottom: 0.1rem;
    }
    .saved-meta {
      color: #9ca3af;
      font-size: 0.75rem;
    }
    .saved-values {
      flex: 0 0 auto;
      text-align: right;
      font-size: 0.78rem;
      color: #e5e7eb;
      margin-right: 0.25rem;
    }
    .saved-values div + div {
      margin-top: 0.15rem;
    }
    .saved-remove {
      flex: 0 0 auto;
      align-self: center;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Möteskostnadskalkylator</h1>
    <p class="subtitle">
      Räkna ut vad ett möte kostar i tid och pengar – per tillfälle, per månad och per år. Varje beräkning sparas i en lista nedan.
    </p>

    <div class="grid">
      <section class="card">
        <h2>Indata</h2>
        <div class="field">
          <label for="meetingTitle">Titel på mötet (valfritt)</label>
          <input id="meetingTitle" type="text" placeholder="Exempel: Veckomöte med ledningsgrupp" />
        </div>

        <div class="field">
          <label for="participants">Antal deltagare</label>
          <div class="inline">
            <input id="participants" type="number" min="1" inputmode="numeric" placeholder="Ex. 8" />
            <span class="unit">personer</span>
          </div>
          <div class="hint">Inkludera alla som deltar i mötet.</div>
        </div>

        <div class="field">
          <label for="hourlyRate">Genomsnittlig timkostnad per person</label>
          <div class="inline">
            <input id="hourlyRate" type="number" min="0" step="50" inputmode="decimal" placeholder="Ex. 600" />
            <span class="unit">kr/timme</span>
          </div>
          <div class="hint">Lön + sociala avgifter + overhead (grovt estimat).</div>
        </div>

        <div class="field">
          <label for="durationMinutes">Möteslängd</label>
          <div class="inline">
            <input id="durationMinutes" type="number" min="1" inputmode="numeric" placeholder="Ex. 60" />
            <span class="unit">minuter</span>
          </div>
        </div>

        <div class="field">
          <label for="frequency">Återkommande</label>
          <select id="frequency">
            <option value="once">Engångsmöte</option>
            <option value="weekly">Varje vecka</option>
            <option value="biweekly">Varannan vecka</option>
            <option value="monthly">Varje månad</option>
          </select>
          <div class="hint">Välj hur ofta mötet hålls under året.</div>
        </div>

        <div class="field">
          <label for="notes">Anteckning (valfritt)</label>
          <textarea id="notes" placeholder="Exempel: Återkommande statusmöte där hälften av tiden går åt till upprepningar."></textarea>
        </div>

        <div id="error" class="error"></div>

        <div class="actions">
          <button class="primary" id="calculateBtn" type="button">Beräkna möteskostnad</button>
          <button class="secondary" id="resetBtn" type="button">Återställ formulär</button>
        </div>
      </section>

      <section class="card">
        <h2>Resultat</h2>
        <p class="meeting-title" id="meetingTitleDisplay">Ingen beräkning gjord ännu.</p>
        <div class="badge" id="badgeFrequency" style="display:none;">
          <span class="badge-dot"></span>
          <span id="frequencyLabel"></span>
        </div>

        <div class="metrics">
          <div class="metric">
            <div class="metric-label">Kostnad per möte</div>
            <div class="metric-value" id="costPerMeeting">–</div>
            <div class="metric-sub" id="costPerParticipant">–</div>
          </div>
          <div class="metric">
            <div class="metric-label">Per månad</div>
            <div class="metric-value" id="costPerMonth">–</div>
            <div class="metric-sub">Baserat på vald frekvens</div>
          </div>
          <div class="metric">
            <div class="metric-label">Per år</div>
            <div class="metric-value" id="costPerYear">–</div>
            <div class="metric-sub">Summerad årskostnad</div>
          </div>
        </div>

        <div class="footer">
          <span>Använd som underlag i dialoger om möteskultur och effektivisering.</span>
          <div>
            <button class="secondary" id="copyBtn" type="button">Kopiera sammanfattning</button>
            <div id="copyStatus" class="copy-status"></div>
          </div>
        </div>
      </section>
    </div>

    <section class="card">
      <h2>Sparade beräkningar</h2>
      <p class="hint">Varje gång du klickar på "Beräkna möteskostnad" sparas beräkningen här. Du kan ta bort enskilda rader.</p>
      <div id="savedEmpty" class="saved-empty">Inga sparade beräkningar ännu.</div>
      <ul id="savedList" class="saved-list"></ul>
    </section>
  </div>

  <script>
    (function () {
      const participantsInput = document.getElementById("participants");
      const hourlyRateInput = document.getElementById("hourlyRate");
      const durationMinutesInput = document.getElementById("durationMinutes");
      const frequencySelect = document.getElementById("frequency");
      const meetingTitleInput = document.getElementById("meetingTitle");
      const notesInput = document.getElementById("notes");

      const errorEl = document.getElementById("error");

      const meetingTitleDisplay = document.getElementById("meetingTitleDisplay");
      const frequencyLabel = document.getElementById("frequencyLabel");
      const badgeFrequency = document.getElementById("badgeFrequency");

      const costPerMeetingEl = document.getElementById("costPerMeeting");
      const costPerParticipantEl = document.getElementById("costPerParticipant");
      const costPerMonthEl = document.getElementById("costPerMonth");
      const costPerYearEl = document.getElementById("costPerYear");

      const calculateBtn = document.getElementById("calculateBtn");
      const resetBtn = document.getElementById("resetBtn");
      const copyBtn = document.getElementById("copyBtn");
      const copyStatus = document.getElementById("copyStatus");

      const savedListEl = document.getElementById("savedList");
      const savedEmptyEl = document.getElementById("savedEmpty");

      const SAVED_KEY = "meetingCostSavedCalculations_v1";
      let savedItems = [];

      function formatCurrency(value) {
        if (!isFinite(value)) return "–";
        try {
          return new Intl.NumberFormat("sv-SE", {
            style: "currency",
            currency: "SEK",
            maximumFractionDigits: 0,
          }).format(value);
        } catch (e) {
          return Math.round(value).toLocaleString("sv-SE") + " kr";
        }
      }

      function getFrequencyMeta(value) {
        switch (value) {
          case "weekly":
            return { label: "Återkommande möte – varje vecka (~52 ggr/år)", meetingsPerYear: 52 };
          case "biweekly":
            return { label: "Återkommande möte – varannan vecka (~26 ggr/år)", meetingsPerYear: 26 };
          case "monthly":
            return { label: "Återkommande möte – varje månad (12 ggr/år)", meetingsPerYear: 12 };
          case "once":
          default:
            return { label: "Engångsmöte", meetingsPerYear: 1 };
        }
      }

      function validateInputs() {
        errorEl.textContent = "";

        const participants = Number(participantsInput.value);
        const hourlyRate = Number(hourlyRateInput.value);
        const durationMinutes = Number(durationMinutesInput.value);

        if (!participants || participants <= 0) {
          errorEl.textContent = "Ange ett giltigt antal deltagare (> 0).";
          return false;
        }
        if (!hourlyRate || hourlyRate <= 0) {
          errorEl.textContent = "Ange en rimlig genomsnittlig timkostnad per person (> 0).";
          return false;
        }
        if (!durationMinutes || durationMinutes <= 0) {
          errorEl.textContent = "Ange en giltig möteslängd i minuter (> 0).";
          return false;
        }
        return true;
      }

      function buildSummaryText(meta, title, participants, hourlyRate, durationMinutes, frequency, notes, costPerMeeting, costPerParticipant, costPerMonth, costPerYear) {
        let summary = "";
        summary += "Sammanfattning av möteskostnad\n";
        summary += "=================================\n\n";
        summary += "Titel: " + title + "\n";
        summary += "Antal deltagare: " + participants + "\n";
        summary += "Genomsnittlig timkostnad per person: " + hourlyRate + " kr\n";
        summary += "Möteslängd: " + durationMinutes + " minuter\n";
        summary += "Frekvens: " + meta.label + "\n\n";
        summary += "Kostnad per möte: " + costPerMeeting + "\n";
        summary += "Kostnad per deltagare: " + costPerParticipant + "\n";
        if (frequency !== "once") {
          summary += "Kostnad per månad: " + costPerMonth + "\n";
          summary += "Kostnad per år: " + costPerYear + "\n";
        } else {
          summary += "Månad-/årskostnad beräknas ej (engångsmöte).\n";
        }
        if (notes) {
          summary += "\nKommentar/kontext:\n" + notes + "\n";
        }
        summary += "\nSkapad med Möteskostnadskalkylatorn (HTML/JS, GitHub Pages-kompatibel).";
        return summary;
      }

      function saveToLocalStorage() {
        try {
          localStorage.setItem(SAVED_KEY, JSON.stringify(savedItems));
        } catch (e) {
          // Ignorera om localStorage inte är tillgängligt
        }
      }

      function loadFromLocalStorage() {
        try {
          const raw = localStorage.getItem(SAVED_KEY);
          if (!raw) return;
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) {
            savedItems = parsed;
          }
        } catch (e) {
          savedItems = [];
        }
      }

      function renderSavedList() {
        savedListEl.innerHTML = "";
        if (!savedItems.length) {
          savedEmptyEl.style.display = "block";
          return;
        }
        savedEmptyEl.style.display = "none";

        savedItems.forEach(function (item) {
          const li = document.createElement("li");
          li.className = "saved-item";
          li.dataset.id = item.id;

          const mainDiv = document.createElement("div");
          mainDiv.className = "saved-main";
          const titleDiv = document.createElement("div");
          titleDiv.className = "saved-title";
          titleDiv.textContent = item.title;
          const metaDiv = document.createElement("div");
          metaDiv.className = "saved-meta";
          metaDiv.textContent = item.frequencyLabel;
          mainDiv.appendChild(titleDiv);
          mainDiv.appendChild(metaDiv);

          const valuesDiv = document.createElement("div");
          valuesDiv.className = "saved-values";
          const perMeetingDiv = document.createElement("div");
          perMeetingDiv.textContent = formatCurrency(item.costPerMeeting) + " per möte";
          valuesDiv.appendChild(perMeetingDiv);
          if (item.frequency !== "once" && isFinite(item.costPerYear)) {
            const perYearDiv = document.createElement("div");
            perYearDiv.textContent = formatCurrency(item.costPerYear) + " per år";
            valuesDiv.appendChild(perYearDiv);
          }

          const removeBtn = document.createElement("button");
          removeBtn.className = "secondary saved-remove";
          removeBtn.type = "button";
          removeBtn.textContent = "Ta bort";
          removeBtn.dataset.id = item.id;

          li.appendChild(mainDiv);
          li.appendChild(valuesDiv);
          li.appendChild(removeBtn);

          savedListEl.appendChild(li);
        });
      }

      function addSavedItem(data) {
        const meta = getFrequencyMeta(data.frequency);
        const item = {
          id: Date.now().toString(36) + Math.random().toString(16).slice(2),
          title: data.title || "Möte utan titel",
          participants: data.participants,
          hourlyRate: data.hourlyRate,
          durationMinutes: data.durationMinutes,
          frequency: data.frequency,
          frequencyLabel: meta.label,
          costPerMeeting: data.costPerMeeting,
          costPerMonth: data.costPerMonth,
          costPerYear: data.costPerYear,
          createdAt: new Date().toISOString()
        };
        savedItems.unshift(item);
        // Begränsa till t.ex. 50 poster
        if (savedItems.length > 50) {
          savedItems = savedItems.slice(0, 50);
        }
        saveToLocalStorage();
        renderSavedList();
      }

      function removeSavedItem(id) {
        savedItems = savedItems.filter(function (item) {
          return item.id !== id;
        });
        saveToLocalStorage();
        renderSavedList();
      }

      function calculate() {
        if (!validateInputs()) return;

        const participants = Number(participantsInput.value);
        const hourlyRate = Number(hourlyRateInput.value);
        const durationMinutes = Number(durationMinutesInput.value);
        const frequency = frequencySelect.value;
        const title = meetingTitleInput.value.trim();
        const notes = notesInput.value.trim();

        const durationHours = durationMinutes / 60;
        const costPerMeetingNum = participants * hourlyRate * durationHours;
        const costPerParticipantNum = participants > 0 ? costPerMeetingNum / participants : 0;

        const meta = getFrequencyMeta(frequency);
        const meetingsPerYear = meta.meetingsPerYear;
        let costPerYearNum = null;
        let costPerMonthNum = null;

        if (frequency !== "once") {
          costPerYearNum = costPerMeetingNum * meetingsPerYear;
          costPerMonthNum = costPerYearNum / 12;
        }

        meetingTitleDisplay.textContent = title
          ? 'Beräkning för "' + title + '".'
          : "Beräkning för valt möte (ingen titel angiven).";

        badgeFrequency.style.display = "inline-flex";
        frequencyLabel.textContent = meta.label;

        costPerMeetingEl.textContent = formatCurrency(costPerMeetingNum);
        costPerParticipantEl.textContent = "≈ " + formatCurrency(costPerParticipantNum) + " per deltagare";

        if (frequency !== "once") {
          costPerMonthEl.textContent = formatCurrency(costPerMonthNum);
          costPerYearEl.textContent = formatCurrency(costPerYearNum);
        } else {
          costPerMonthEl.textContent = "– (engångsmöte)";
          costPerYearEl.textContent = "– (engångsmöte)";
        }

        // Spara som post i listan
        addSavedItem({
          title: title,
          participants: participants,
          hourlyRate: hourlyRate,
          durationMinutes: durationMinutes,
          frequency: frequency,
          costPerMeeting: costPerMeetingNum,
          costPerMonth: costPerMonthNum,
          costPerYear: costPerYearNum
        });

        // Bygg senast använda sammanfattning för kopiera-funktion
        const summary = buildSummaryText(
          meta,
          title || "Möte utan titel",
          participants,
          hourlyRate,
          durationMinutes,
          frequency,
          notes,
          formatCurrency(costPerMeetingNum),
          "≈ " + formatCurrency(costPerParticipantNum) + " per deltagare",
          frequency !== "once" ? formatCurrency(costPerMonthNum) : "– (engångsmöte)",
          frequency !== "once" ? formatCurrency(costPerYearNum) : "– (engångsmöte)"
        );
        // Spara summary temporärt på elementet för återanvändning vid kopiera
        copyBtn.dataset.summary = summary;
        copyStatus.textContent = "";
      }

      function resetForm() {
        meetingTitleInput.value = "";
        participantsInput.value = "";
        hourlyRateInput.value = "";
        durationMinutesInput.value = "";
        frequencySelect.value = "once";
        notesInput.value = "";
        errorEl.textContent = "";
        meetingTitleDisplay.textContent = "Ingen beräkning gjord ännu.";
        badgeFrequency.style.display = "none";
        costPerMeetingEl.textContent = "–";
        costPerParticipantEl.textContent = "–";
        costPerMonthEl.textContent = "–";
        costPerYearEl.textContent = "–";
        copyStatus.textContent = "";
        delete copyBtn.dataset.summary;
      }

      async function copySummary() {
        const summary = copyBtn.dataset.summary;
        if (!summary) {
          copyStatus.textContent = "Gör först en beräkning att kopiera.";
          return;
        }
        try {
          if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(summary);
          } else {
            const textArea = document.createElement("textarea");
            textArea.value = summary;
            textArea.style.position = "fixed";
            textArea.style.top = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
          }
          copyStatus.textContent = "Sammanfattningen är kopierad till urklipp.";
        } catch (e) {
          copyStatus.textContent = "Kunde inte kopiera automatiskt – markera och kopiera manuellt.";
        }
      }

      // Event-lyssnare
      calculateBtn.addEventListener("click", calculate);
      resetBtn.addEventListener("click", resetForm);
      copyBtn.addEventListener("click", copySummary);

      // Ta bort-knappar i listan (event delegation)
      savedListEl.addEventListener("click", function (event) {
        const target = event.target;
        if (target && target.classList.contains("saved-remove")) {
          const id = target.dataset.id;
          if (id) {
            removeSavedItem(id);
          }
        }
      });

      // Ladda sparade beräkningar vid start
      loadFromLocalStorage();
      renderSavedList();
    })();
  </script>
</body>
</html>
